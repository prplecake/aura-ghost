image: alpine/edge
packages:
  - npm
  - aws-cli
  - zip
secrets:
  - cd2e1b97-e567-47ee-95e9-b4a4894011b3
sources:
  - https://git.sr.ht/~mjorgensen/aura
tasks:
  - init: |
      sudo npm install -g gscan
  - gscan: |
      gscan aura
  - check-branch: |
      cd aura
      if [ "$(git rev-parse master)" != "$(git rev-parse HEAD)" ]; then
        complete-build;
      fi
  - dist: |
      zip -r aura-latest.zip aura --exclude "*/.git*"
      aws s3 cp aura-latest.zip s3://files.splat.soy/dist/aura/